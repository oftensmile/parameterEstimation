\documentclass[11pt]{article}
\usepackage[top=20mm, bottom=30mm, left = 20mm, right=20mm]{geometry}%Set blank space of this article
\usepackage{graphicx}
\usepackage{float}
\usepackage{amsmath}
\setlength{\parindent}{1cm}
\usepackage{amsmath,amssymb}
\begin{document}
\begin{abstract}
このノートでは、CD法の凸性証明、CD法の勾配のCross Entropyを用いた表現、およびCD法の非一致性についてまとめました。凸性の照明がメインで、あとはおまけです。
\begin{itemize}
	\item CD法の凸性についての証明(CD法の評価関数が凸関数であるという論文は探した所、(少なくともAnalyticalには)見つからなかったです。凸性を利用した不等式が幾つか知られているため、それらを使用すれ不偏推定かどうか(あるいはバイアスの性質)が分かるかもしれません。\\
	\item CD法の勾配の式は、任意の指数分布族の場合でもCross Entropyの形式で書き直す事ができます(CD法が実際にどのような計算をしているのか理解する助けになるかもしれません)。 \\
	\item CD法は一致性(標本数を増やせば推定値と真値の差はゼロに収束する性質)がない。既に分かっていた事ではありますが記録として残しておきます。\\
\end{itemize}
\end{abstract}

\section{CD法の凸性証明}
\subsection{準備}
この章では凸性の証明の前に、一変数の確率、遷移確率の定義を行います。
$p(X,Y|\theta)$をパラメータ$\theta$に依存する、確率変数X,Yの同時確率とし,簡単のためXはYからの遷移によって得られる確率変数であるとします。
\begin{eqnarray}
%	\lvert p(Y) \rvert
%	= \sum_{y\in {\mathcal D}}\delta(y,Y)/|{\mathcal D}| \begin{cases}
%	    & \text{$x \ge 0$のとき} \\
%      -x &\text{それ以外のとき}
%    \end{cases}
	p(Y=y)=\frac{1}{|{\mathcal D}|}\sum_{y'\in {\mathcal D}}\delta(y,y')\  \text{for }\ y \in \{-1,+1\}^d
\end{eqnarray}
\begin{eqnarray}
	p(X=x|\theta)= \sum_{y}p(x|y;\theta)p(y|\theta) 
\end{eqnarray}
ここでyが与えられた下でのxの条件つき確率$p(x|y;\theta)$はyからxへの遷移確率に相当し、以下のように定義します。
\begin{eqnarray}
	\lvert p(X=x) \rvert
	=\begin{cases}
	\Gamma_{xy}(\theta)& \text{$y\in {\mathcal D}$ and $\|y-x\|=1$} \\
	1-\sum_{y'|\|y'-x \|=1 }\Gamma_{y'x}(\theta) & \text{$y\in {\mathcal D}$ and $\|y-x\|=0$} \\
      	0 &\text{else}
    \end{cases}
\end{eqnarray}
$\Gamma_{xy}(\theta) $には任意性があります.例えば以下のように与えるとします。yの状態からHamming距離1で遷移できる場合の数はd通りとなります。どの状態が提案されるかは一様確率であるとし
\begin{equation}
	\Gamma_{xy}(\theta):=d^{-1}\frac{e^{-\theta g(x)}}{e^{-\theta g(x)}+e^{-\theta g(y)}}=d^{-1}[1+e^{\theta \Delta g(x,y)}],\ \Delta g(x,y):=g(x)-g(y) \label{eq:transitMat}
\end{equation}
すべての確率は状態空間全体で定義されることに注意します（確率分布の定義域が状態空間全体であることから、同時確率の和は交換できます）。\\
\subsection{凸性の証明}
前節の定義を踏まえて、CD法の勾配を書き下して整理します(ただし、$p(Y=y)\to p(y)$と略記しました)。
\begin{eqnarray}
	\frac{\partial}{\partial \theta}CD(\theta)&=&\langle g(x) \rangle^{(0)}-\langle g(1) \rangle^{(1)}_{x|\theta}\\
&=&\sum_{y}g(y)p^{(0)}(y)-\sum_{x}g(x)\sum_{y}p(x|y;\theta)p^{(0)}(y)\\
&=&\sum_{y}p^{{(0)}}(y)\{g(y)-\sum_{x}g(x)p(x|y;\theta) \}\\
&=&\sum_{y}p^{{(0)}}(y)\{g(y)-\sum_{x}g(x)[\ \Gamma_{xy}(\theta)\delta(\|x-y\|-1)+(1-\sum_{y'(\not =x)}\Gamma_{y'x}(\theta))\delta(\|x-y\|)\ ] \}\\
&=&\sum_{y}p^{{(0)}}(y)\{g(y)-\sum_{x}g(x)\delta(\|x-y\|)\}  \\ \nonumber
&&-\sum_{y}p^{{(0)}}(y)[\  \sum_{x}g(x)\Gamma_{xy}(\theta)\delta(\|x-y\|-1)-g(y)\sum_{y'(\not = y))}\Gamma_{y'y}(\theta) \ ] \} \\
&=&0+\sum_{y}p^{(0)}(y)  \sum_{x}\ [g(y)-g(x)]\ \Gamma_{xy}(\theta)\delta(\|x-y\|-1) \label{eq:grad-CD}
\end{eqnarray}
従って、評価関数の勾配は$g(y)-g(x)$、すなわち十分統計量(sufficient statistics)が遷移確率の重みの役割になっていることがわかります。\\
$CD(\theta)=\int^{\theta}\text{eq.(\ref{eq:grad-CD})}$です。eq(\ref{eq:grad-CD})の$\theta$依存性は遷移確率の項のみであるので、知るべきは遷移確率のパラメータ積分です。\\
eq(\ref{eq:transitMat})を用いて、具体的に計算を実行すると以下のようになります。
\begin{eqnarray}
	\int^{\theta}\Gamma_{xy}(\theta) d\theta' &=&\int^{\theta}d^{-1}\ [1+e^{\theta'(g(x)-g(y))}]\  d\theta'\\
						  &=&\int^{\theta}d^{-1}\ [1+e^{\theta'\phi(x,y)}]\  d\theta'\\
	       &=&-\frac{\log(e^{-\theta\phi(x,y)}+1)}{\phi(x,y)}+\text{const}\label{eq:Int-transMat}
\end{eqnarray}
eq(\ref{eq:grad-CD})とeq(\ref{eq:Int-transMat})の結果を合わせると。
\begin{eqnarray}
	CD(\theta)&=&\int^{\theta}d\theta' \sum_{y}p^{(0)}(y)  \sum_{x}\ [g(y)-g(x)]\ \Gamma_{xy}(\theta')\delta(\|x-y\|-1) \\
&=&\sum_{y}p^{(0)}(y)  \sum_{x}\ -\phi(x,y)\ \delta(\|x-y\|-1)\int^{\theta}d\theta'\Gamma_{xy}(\theta') \\
&=&\sum_{y}p^{(0)}(y)  \sum_{x}\ -\phi(x,y)\ \delta(\|x-y\|-1)\ \{-\frac{\log(e^{-\theta\phi(x,y)}+1)}{\phi(x,y)}+\text{const}\ \}\\ 
&=&\sum_{y}\sum_{x}\ \delta(\|x-y\|-1)\ p^{(0)}(y)  \{\log(e^{-\theta\phi(x,y)}+1)+\text{const}\ \} \label{eq:convexity} 
\end{eqnarray}
leq(\ref{eq:convexity})はパラメータ$\theta$に対しての凸関数になります。\\
\\
(略証)\\
logが凸関数であること。および、凸関数に非負の係数を掛けて足し合わせた関数もまた凸関数であるからです。
$f_i(\xi)\in \{ \text{convex function } \}$, に対して、係数を$\alpha_i>0$, for $i=1,..,n$とするとき
\begin{equation}
	F(\xi)=\sum_{i}^{n}\alpha_{i} f_{i}(\xi) \in \{\text{convex function} \}
\end{equation}
\\
(補足)\\
関数fが凸である場合、以下の性質を満たします\\
$\lambda\in (0,1),a\leq b$;
\begin{equation}
	f(\lambda a + (1-\lambda)b)\leq \lambda f(a)+ (1-\lambda)f(b)
\end{equation}
CD法の評価関数の凸性は私が調べた限りでは報告がありませんでした(CD法はRestricted Boltzmann Machine(RB)に使われる例が多いと思うのですが(隠れ変数を使ったボルツマンマシンです)、RBに対しては凸では無いと言っている論文もあったりします)。
%
%---------------------------------------------
\subsection{凸性を使用した収束性の証明(考え中です)}
凸性を利用した不等式は数多くあるので、それらの道具を使って不偏推定性(バイアスの性質)を調べられないかと考えているところです。\\
いつか見たことがある、不偏性を調べるのに使えそうだなぁと考えているのですが、、この様な不等式をご存知でしたら教えていただきたいです。
\begin{equation}
	\|\theta^{(1)}-\theta^{(2)}\|\  \leq\  \|\frac{\partial f(\theta^{(1)})}{\partial \theta}-\frac{\partial f(\theta^{(2)})}{\partial \theta}\|
\end{equation}

\subsection{CDの評価関数とパラメータの事前分布}
CDの評価関数は$p(x|y;\theta)$の形です。今の場合は、パラメータについてnatural parameter spaceで一様確率を仮定している事に相当します。事前分布を仮定して最適化することを認めれば、うまくバイアスが生じない推定ができるのではないかと考えています。(本当は$KL(p^{(0)}\|p^{(\infty)}(\theta)-KL(p^{(1)}\|p^{(\infty)}(\theta)$と前節で得られた$CD(\theta)$との差異や他の推定手法との関係を事前分布を介して関連付けしたいのですが、推定手法ごとの評価関数の勾配の違いに確率変数が含まれてきてしまっているため、この考えはダメかもしれません。)\\


\section{CD法の勾配をCross Entropyで表現する}

勾配をCross Entropyの表現で書き表します。この書き換えは一般の指数分布族に対して適応できます。\\
\\
定義:Cross Entropy(交差エントロピー)
\begin{equation}
C(p,q):=-\sum_{x}p(x)\log{q(x)}
\end{equation}
確率分布間の独立性を調べるのに使えそうなentropy量としてMutual Information(相互情報量)
定義:Mutual Information
\begin{equation}
	I(x;y):=\sum_{x,y}p(x,y)\log{\frac{p(x,y)}{p(x)p(y)}}
\end{equation}
(当初は、相互情報量で書かれるのではないかと期待していたのですが、そうはならなかったです。)\\
CD法評価関数の書き換え\\
\begin{eqnarray}
	\frac{\partial }{\partial \theta}CD(\theta)&=&\langle g(x)\rangle^{(0)}-\langle g(x) \rangle^{(1)}_{x|\theta}\\
	&=&\sum_{y}g(y)p(y)-\sum_{y}\sum_{x}g(x)p(x|y;\theta)p(y)\\
	&=&\sum_{y}\sum_{x}[\ g(y)-g(x)\ ]p(x|y;\theta)\\
	&=&\frac{1}{N}\sum_{x^{(n)}\in {\mathcal D} }\sum_{x\in \partial x^{(n)}}[\ g(x^{(n)})-g(x)\ ]p(x|x^{(n)};\theta)\\
	&=&\frac{1}{N}\sum_{x^{(n)}\in {\mathcal D} }\sum_{x\in \partial x^{(n)}}\frac{-1}{\theta'}[\ \log{p^{(\infty)}(x^{(n)}|\theta')}-\log{p^{(\infty)}(x|\theta')}\ ]p(x|x^{(n)};\theta)\\
	&=&-\frac{1}{N}\frac{1}{\theta'}\sum_{x^{(n)}\in {\mathcal D} }\log{p^{(\infty)}(x^{(n)}|\theta')}+\frac{1}{\theta'}\sum_{x}p(x|\theta)\log{p^{(\infty)}(x|\theta')}\\
	&=&\frac{1}{\theta}\{C(p^{(1)}(\ |\theta), p^{(\infty)}) - C(p^{(0)}(\ |\theta), p^{(\infty)})\}
\end{eqnarray}
余談ですが、KL-DivergenceとCross Entropy の関係は以下のようになります。
\begin{equation}
	KL(p\|q)=\sum_{x}p(x)\log\frac{p(x)}{q(x)}=-H(q)+C(p,q)
\end{equation}

\section{CD法が一致性を持たないことの証明}
最尤推定は、一致性が成り立つにも関わらず、CD法では一致性が成り立たないことをこの節では書こうと思っているのですが、力尽きてきたためひとまず明日以降にします。\\
考え方は、CD法はKL-Divergenceの形で書いているため、一致性を示せないんだと思います(以前話亭ことです。)。
%\bibliography{main}
\end{document}
%Below of this line is not printed
